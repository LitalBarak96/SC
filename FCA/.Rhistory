# Load loomR
library(loomR)
library(Seurat)
setwd("E:/seq_data/FCA/")
loom_file <- connect(filename = "r_fca_biohub_head_10x.loom", mode = "r+", skip.validate=TRUE)
matrix_data <- as.data.frame(loom_file[["matrix"]][1,])
View(matrix_data)
matrix_data <- as.data.frame(loom_file[["matrix"]][1,1])
View(matrix_data)
matrix_data <- as.data.frame(loom_file[["matrix"]][,1])
View(matrix_data)
coltest<-loom_file[["col_attrs/CellID"]][]
coltest<-as.data.frame(loom_file[["col_attrs/CellID"]][])
View(coltest)
rowtest<-as.data.frame(loom_file[["row_attrs/Gene"]][])
View(rowtest)
View(coltest)
summary(colt\
summary(coltest)
coltest<-as.factor(as.data.frame(loom_file[["col_attrs/CellID"]][]))
coltest<-as.data.frame(as.factor(loom_file[["col_attrs/CellID"]][]))
View(coltest)
levels(coltest)
colnames(coltest)<-"cellid"
View(coltest)
grep_test<-dplyr::filter(coltest, !grepl("Female",cellid))
View(grep_test)
View(grep_test)
View(coltest)
matrix_data <- as.data.frame(loom_file[["matrix"]][,])
# Install devtools from CRAN
#install.packages("devtools")
# Use devtools to install hdf5r and loomR from GitHub
#devtools::install_github(repo = "hhoeflin/hdf5r")
#devtools::install_github(repo = "mojaveazure/loomR", ref = "develop")
#devtools::install_github('satijalab/seurat-data')
#devtools::install_github("thomasp85/patchwork")
# Load loomR
library(loomR)
library(Seurat)
setwd("E:/seq_data/FCA/")
loom_file <- connect(filename = "r_fca_biohub_head_10x.loom", mode = "r+", skip.validate=TRUE)
#coltest<-as.data.frame(as.factor(loom_file[["col_attrs/CellID"]][]))
#colnames(coltest)<-"cellid"
#rowtest<-as.data.frame(loom_file[["row_attrs/Gene"]][])
#male_sample<-dplyr::filter(coltest, !grepl("Female",cellid))
matrix_data <- as.data.frame(loom_file[["matrix"]][,])
rownames(matrix_data) <- loom_file[["col_attrs/CellID"]][]
colnames(matrix_data) <- loom_file[["row_attrs/Gene"]][]
#matrix_data$annotation<-loom_file[["col_attrs/S_annotation"]][]
# library("writexl")
#write_xlsx(matrix_data,"E:/seq_data/FCA/loom_r_fac_head.xlsx")
#write.csv(matrix_data,"E:/seq_data/FCA/loom_r_fac_head.csv", row.names = TRUE)
#head(matrix_data)
#small_test<-matrix_data[1:10,1:10]
highNpfr<-as.matrix(matrix_data[matrix_data$NPFR>1,])
SERUAT_NPFR <- CreateSeuratObject(counts = t(highNpfr), project = "high Npfr", min.cells = 0, min.features=0)
matrix_data <- as.data.frame(loom_file[["matrix"]][,])
rownames(matrix_data) <- loom_file[["col_attrs/CellID"]][]
colnames(matrix_data) <- loom_file[["row_attrs/Gene"]][]
matrix_data$annotation<-loom_file[["col_attrs/S_annotation"]][]
small_test<-matrix_data[1:10,1:10]
mydata2 = select(small_test, -annotation)
drops <- c("annotation")
small_test[ , !(names(small_test) %in% drops)]
View(small_test)
drops <- c("140up")
small_test[ , !(names(small_test) %in% drops)]
View(small_test)
drops <- c("140up")
test<-small_test[ , !(names(small_test) %in% drops)]
View(test)
highNpfr<-as.matrix(matrix_data[matrix_data$NPFR>1,])
drops <- c("annotation")
woAnn<-highNpfr[ , !(names(highNpfr) %in% drops)]
View(highNpfr)
highNpfr<-(matrix_data[matrix_data$NPFR>1,])
drops <- c("annotation")
woAnn<-highNpfr[ , !(names(highNpfr) %in% drops)]
SERUAT_NPFR <- CreateSeuratObject(counts = t(woAnn), project = "high Npfr", min.cells = 0, min.features=0)
SERUAT_NPFR <- NormalizeData(SERUAT_NPFR, normalization.method = "LogNormalize", scale.factor = 10000)
View(SERUAT_NPFR)
View(SERUAT_NPFR@meta.data)
SERUAT_NPFR[["percent.mt"]] <- PercentageFeatureSet(SERUAT_NPFR, pattern = "^MT-")
View(SERUAT_NPFR)
VlnPlot(nsclc.seurat.obj, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
VlnPlot(SERUAT_NPFR, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
VlnPlot(SERUAT_NPFR, features = c("nFeature_RNA", "nCount_RNA"), ncol = 2)
SERUAT_NPFR[["percent.npf"]] <- PercentageFeatureSet(SERUAT_NPFR, pattern = "^NPF-")
VlnPlot(SERUAT_NPFR, features = c("nFeature_RNA", "nCount_RNA","percent.npf"), ncol = 3)
VlnPlot(SERUAT_NPFR, features = c("nFeature_RNA", "nCount_RNA"), ncol = 2)
FeatureScatter(SERUAT_NPFR, feature1 = "nCount_RNA", feature2 = "nFeature_RNA") +
geom_smooth(method = 'lm')
library(ggplot2)
FeatureScatter(SERUAT_NPFR, feature1 = "nCount_RNA", feature2 = "nFeature_RNA") +
geom_smooth(method = 'lm')
SERUAT_NPFR <- NormalizeData(SERUAT_NPFR, normalization.method = "LogNormalize", scale.factor = 10000)
SERUAT_NPFR <- FindVariableFeatures(SERUAT_NPFR, selection.method = "vst", nfeatures = 2000)
# Identify the 10 most highly variable genes
top10 <- head(VariableFeatures(SERUAT_NPFR), 10)
plot1 <- VariableFeaturePlot(SERUAT_NPFR)
LabelPoints(plot = plot1, points = top10, repel = TRUE)
View(SERUAT_NPFR)
test<- highNpfr["annotation"]
View(test)
ann<- highNpfr["annotation"]
View(ann)
SERUAT_NPFR$celltypes <ann
View(SERUAT_NPFR)
install.packages("SingleR")
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("SingleR")
all.genes <- rownames(SERUAT_NPFR)
SERUAT_NPFR <- ScaleData(SERUAT_NPFR, features = all.genes)
str(SERUAT_NPFR)
SERUAT_NPFR <- RunPCA(SERUAT_NPFR, features = VariableFeatures(object = SERUAT_NPFR))
print(SERUAT_NPFR[["pca"]], dims = 1:5, nfeatures = 5)
DimHeatmap(SERUAT_NPFR, dims = 1, cells = 500, balanced = TRUE)
ElbowPlot(SERUAT_NPFR)
SERUAT_NPFR <- FindNeighbors(SERUAT_NPFR, dims = 1:12)
SERUAT_NPFR <- FindClusters(SERUAT_NPFR, resolution = c(0.1,0.3, 0.5, 0.7, 1))
View(SERUAT_NPFR@meta.data)
DimPlot(SERUAT_NPFR, group.by = "RNA_snn_res.0.5", label = TRUE)
DimPlot(SERUAT_NPFR, group.by = "RNA_snn_res.0.1", label = TRUE)
DimPlot(SERUAT_NPFR, group.by = "RNA_snn_res.0.3", label = TRUE)
DimPlot(SERUAT_NPFR, group.by = "RNA_snn_res.0.7", label = TRUE)
DimPlot(SERUAT_NPFR, group.by = "RNA_snn_res.0.1", label = TRUE)
Idents(SERUAT_NPFR)
Idents(SERUAT_NPFR) <- "RNA_snn_res.0.1"
Idents(SERUAT_NPFR)
SERUAT_NPFR <- RunUMAP(SERUAT_NPFR, dims = 1:15)
DimPlot(SERUAT_NPFR, reduction = "umap")
DefaultAssay(SERUAT_NPFR) <- "RNA"
Seurat::FeaturePlot(SERUAT_NPFR, "NPF")
ElbowPlot(SERUAT_NPFR)
SERUAT_NPFR <- FindNeighbors(SERUAT_NPFR, dims = 1:15)
SERUAT_NPFR <- FindClusters(SERUAT_NPFR, resolution = c(0.1,0.3, 0.5, 0.7, 1))
View(SERUAT_NPFR@meta.data)
DimPlot(SERUAT_NPFR, group.by = "RNA_snn_res.0.3", label = TRUE)
Idents(SERUAT_NPFR)
Idents(SERUAT_NPFR) <- "RNA_snn_res.0.3"
Idents(SERUAT_NPFR)
SERUAT_NPFR <- RunUMAP(SERUAT_NPFR, dims = 1:15)
DimPlot(SERUAT_NPFR, reduction = "umap")
DefaultAssay(SERUAT_NPFR) <- "RNA"
Seurat::FeaturePlot(SERUAT_NPFR, "NPF")
Seurat::FeaturePlot(SERUAT_NPFR, "NPFR")
Seurat::FeaturePlot(SERUAT_NPFR, "NPF")
