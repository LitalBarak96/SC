---
title: "Untitled"
author: "Lital Barak"
date: "2023-08-02"
output: html_document
---

```{r}
sc_data<-read.csv("D:/OneDrive - Bar Ilan University/Lital/weekly presentation/16.7.23/mat_avg_elav_wo_tbh.csv",check.names=FALSE,row.names = 1)
# write.csv(all,"D:/OneDrive - Bar Ilan University/Lital/weekly presentation/16.7.23/mat_avg_elav_wo_tbh.csv")
sc_genes<-read.csv("D:/OneDrive - Bar Ilan University/Lital/weekly presentation/16.7.23/sig_elav_gene.csv")

bulk_gene<-read.csv("D:/OneDrive - Bar Ilan University/Lital/weekly presentation/30.07.23/yulia_de_genes.csv")


bulk_data<-read.csv("D:/OneDrive - Bar Ilan University/Lital/weekly presentation/30.07.23/yulia_data.csv",row.names = 1)

```




```{r}
avarges<-NULL



main_data<-as.data.frame(bulk_data)
#avarges$Geneid<-main_data$Geneid
avarges$fru<-rowMeans(x=main_data[ , grepl( "fru" , names( main_data ) ) ], na.rm = TRUE)
#avarges$dh44<-rowMeans(x=main_data[ , grepl( "dh44" , names( main_data ) ) ], na.rm = TRUE)
avarges$npf<-rowMeans(x=main_data[ , grepl( "npf" , names( main_data ) ) ], na.rm = TRUE)
avarges$npfr<-rowMeans(x=main_data[ , grepl( "npfr" , names( main_data ) ) ], na.rm = TRUE)
avarges$tdc2<-rowMeans(x=main_data[ , grepl( "tdc2" , names( main_data ) ) ], na.rm = TRUE)
avarges$crz<-rowMeans(x=main_data[ , grepl( "crz" , names( main_data ) ) ], na.rm = TRUE)
avarges$th<-rowMeans(x=main_data[ , grepl( "th" , names( main_data ) ) ], na.rm = TRUE)
#avarges$trh<-rowMeans(x=main_data[ , grepl( "trh" , names( main_data ) ) ], na.rm = TRUE)
avarges$ok107<-rowMeans(x=main_data[ , grepl( "ok107" , names( main_data ) ) ], na.rm = TRUE)

avarges$elav<-rowMeans(x=main_data[ , grepl( "elav" , names( main_data ) ) ], na.rm = TRUE)


avarges<-as.data.frame(avarges)

rownames(avarges)<-rownames(main_data)
```

```{r}
genes_bulk <- c((bulk_gene$gene))


bulk<-avarges[genes_bulk, ]


  genes_sc <- c((sc_genes$X))


sc<-sc_data[genes_sc, ]
sc<-na.omit(sc)


```

```{r}

scale_rows = function(x){
    m = apply(x, 1, mean, na.rm = T)
    s = apply(x, 1, sd, na.rm = T)
    return((x - m) / s)
}

scale_mat = function(mat, scale){
    if(!(scale %in% c("none", "row", "column"))){
        stop("scale argument shoud take values: 'none', 'row' or 'column'")
    }
    mat = switch(scale, none = mat, row = scale_rows(mat), column = t(scale_rows(t(mat))))
    return(mat)
}


normlized_bulk<-scale_mat(bulk,"row")
normlized_sc<-scale_mat(sc,"row")


enriched_bulk<-normlized_bulk[abs(normlized_bulk$npfr) > 1.5,]

enriched_sc<-normlized_sc[abs(normlized_sc$NPFR) > 1.5,]


write.csv(enriched_bulk,"D:/OneDrive - Bar Ilan University/Lital/weekly presentation/30.07.23/bulk_npfr_1_5_abs.csv")
write.csv(enriched_sc,"D:/OneDrive - Bar Ilan University/Lital/weekly presentation/30.07.23/sc_npfr_1_5_abs.csv")



```

```{r}



gene_bulk<-bulk_gene$X
gene_sc<-sc_genes$X

Overlap <- calculate.overlap(x = list(gene_bulk,gene_sc))
plot(Overlap)
```

