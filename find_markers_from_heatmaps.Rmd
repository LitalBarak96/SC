---
title: "Untitled"
author: "Lital Barak"
date: "2023-08-02"
output: html_document
---

```{r}
sc_data<-read.csv("C:/Users/barakli8/OneDrive - Bar Ilan University/Lital/weekly presentation/16.7.23/mat_avg_elav_wo_tbh.csv",check.names=FALSE,row.names = 1)
# write.csv(all,"D:/OneDrive - Bar Ilan University/Lital/weekly presentation/16.7.23/mat_avg_elav_wo_tbh.csv")
sc_genes<-read.csv("C:/Users/barakli8/OneDrive - Bar Ilan University/Lital/weekly presentation/16.7.23/sig_elav_gene.csv")

bulk_gene<-read.csv("C:/Users/barakli8/OneDrive - Bar Ilan University/Lital/weekly presentation/30.07.23/yulia_de_genes.csv")


bulk_data<-read.csv("C:/Users/barakli8/OneDrive - Bar Ilan University/Lital/weekly presentation/14.8.23/wo_dh44/yulia_data.csv",row.names = 1)

```




```{r}
avarges<-NULL



main_data<-as.data.frame(bulk_data)
#avarges$Geneid<-main_data$Geneid
avarges$fru<-rowMeans(x=main_data[ , grepl( "fru" , names( main_data ) ) ], na.rm = TRUE)
#avarges$dh44<-rowMeans(x=main_data[ , grepl( "dh44" , names( main_data ) ) ], na.rm = TRUE)
avarges$npf<-rowMeans(x=main_data[ , grepl( "npf" , names( main_data ) ) ], na.rm = TRUE)
avarges$npfr<-rowMeans(x=main_data[ , grepl( "npfr" , names( main_data ) ) ], na.rm = TRUE)
avarges$tdc2<-rowMeans(x=main_data[ , grepl( "tdc2" , names( main_data ) ) ], na.rm = TRUE)
avarges$crz<-rowMeans(x=main_data[ , grepl( "crz" , names( main_data ) ) ], na.rm = TRUE)
avarges$th<-rowMeans(x=main_data[ , grepl( "th" , names( main_data ) ) ], na.rm = TRUE)
#avarges$trh<-rowMeans(x=main_data[ , grepl( "trh" , names( main_data ) ) ], na.rm = TRUE)
avarges$ok107<-rowMeans(x=main_data[ , grepl( "ok107" , names( main_data ) ) ], na.rm = TRUE)

avarges$elav<-rowMeans(x=main_data[ , grepl( "elav" , names( main_data ) ) ], na.rm = TRUE)


avarges<-as.data.frame(avarges)

rownames(avarges)<-rownames(main_data)
```

```{r}
genes_bulk <- c((bulk_gene$gene))


bulk<-avarges[genes_bulk, ]


  genes_sc <- c((sc_genes$X))


sc<-sc_data[genes_sc, ]
sc<-na.omit(sc)


```

```{r}

scale_rows = function(x){
    m = apply(x, 1, mean, na.rm = T)
    s = apply(x, 1, sd, na.rm = T)
    return((x - m) / s)
}

scale_mat = function(mat, scale){
    if(!(scale %in% c("none", "row", "column"))){
        stop("scale argument shoud take values: 'none', 'row' or 'column'")
    }
    mat = switch(scale, none = mat, row = scale_rows(mat), column = t(scale_rows(t(mat))))
    return(mat)
}


normlized_bulk<-scale_mat(bulk,"row")
normlized_sc<-scale_mat(sc,"row")

# 
# enriched_bulk<-normlized_bulk[abs(normlized_bulk$npfr) > 1,]
# 
# enriched_sc<-normlized_sc[abs(normlized_sc$NPFR) > 1,]


current_gene<-"npf"

enriched_bulk<-normlized_bulk[(normlized_bulk$npf) > 1.5,]

enriched_sc<-normlized_sc[(normlized_sc$NPF) > 1.5,]

write.csv(enriched_bulk,paste0("D:/OneDrive - Bar Ilan University/Lital/weekly presentation/30.07.23/bulk_up_",current_gene,".csv"))
write.csv(enriched_sc,paste0("D:/OneDrive - Bar Ilan University/Lital/weekly presentation/30.07.23/sc_up_",current_gene,".csv"))



```

```{r}


# 
# gene_bulk<-bulk_gene$X
# gene_sc<-sc_genes$X
# 
# Overlap <- calculate.overlap(x = list(gene_bulk,gene_sc))
# plot(Overlap)
```
```{r}


current_gene<-"th"

    enriched_bulk<-normlized_bulk[(normlized_bulk$th) < (-1.5),]

    #enriched_sc<-normlized_sc[(normlized_sc$ple) < (-1.5),]

write.csv(enriched_bulk,paste0("D:/OneDrive - Bar Ilan University/Lital/weekly presentation/30.07.23/bulk_down_",current_gene,".csv"))
#write.csv(enriched_sc,paste0("D:/OneDrive - Bar Ilan University/Lital/weekly presentation/30.07.23/sc_down_",current_gene,".csv"))



all<-bulk_data
# write.csv(all,"D:/OneDrive - Bar Ilan University/Lital/weekly presentation/16.7.23/mat_avg_elav_wo_tbh.csv")
sig_genes<-rownames(enriched_bulk)

all<-as.matrix(all) 
# write.csv(avarges,"C:/Users/barakli8/OneDrive - Bar Ilan University/Lital/weekly presentation/30.07.23/yulia_gene_sc_data.csv")

#this is the genes from yulia

tmp_gene<-c((sig_genes))
mat<-all[row.names(all) %in% tmp_gene, ]
#test_scale<-scale(mat)
mat<-as.data.frame(mat)
mat<-mat[apply(mat, 1, function(x) !all(x==0)),]

#test_scale<-mat+0.001


  plotname<-paste0("D:/OneDrive - Bar Ilan University/Lital/weekly presentation/14.8.23/wo_dh44/",current_gene,"_down_bulk.tiff")
 tiff(file=plotname,units="in",height=11,width=11,res=600)

pheatmap(mat, scale = "row", cluster_cols = T,cluster_rows  = T,show_rownames = T,fontsize_row = 3, fontsize_col = 8,color=colorRampPalette(c("navy", "white", "red"))(50))

dev.off()



all<-sc_data
# write.csv(all,"D:/OneDrive - Bar Ilan University/Lital/weekly presentation/16.7.23/mat_avg_elav_wo_tbh.csv")
sig_genes<-rownames(enriched_sc)

all<-as.matrix(all) 
# write.csv(avarges,"C:/Users/barakli8/OneDrive - Bar Ilan University/Lital/weekly presentation/30.07.23/yulia_gene_sc_data.csv")


tmp_gene<-c((sig_genes))
mat<-all[row.names(all) %in% tmp_gene, ]
#test_scale<-scale(mat)
mat<-as.data.frame(mat)
mat<-mat[apply(mat, 1, function(x) !all(x==0)),]

#test_scale<-mat+0.001

  plotname<-paste0("D:/OneDrive - Bar Ilan University/Lital/weekly presentation/14.8.23/wo_dh44/",current_gene,"_down_sc.tiff")
 tiff(file=plotname,units="in",height=11,width=11,res=600)

pheatmap(mat, scale = "row", cluster_cols = T,cluster_rows  = T,show_rownames = T,fontsize_row = 8, fontsize_col = 8,color=colorRampPalette(c("navy", "white", "red"))(50))

dev.off()

```
```{r}
all<-sc_data
# write.csv(all,"D:/OneDrive - Bar Ilan University/Lital/weekly presentation/16.7.23/mat_avg_elav_wo_tbh.csv")
sig_genes<-rownames(enriched_sc)

all<-as.matrix(all) 
# write.csv(avarges,"C:/Users/barakli8/OneDrive - Bar Ilan University/Lital/weekly presentation/30.07.23/yulia_gene_sc_data.csv")


tmp_gene<-c((sig_genes))
mat<-all[row.names(all) %in% tmp_gene, ]
#test_scale<-scale(mat)
mat<-as.data.frame(mat)
mat<-mat[apply(mat, 1, function(x) !all(x==0)),]

#test_scale<-mat+0.001

  plotname<-paste0("D:/OneDrive - Bar Ilan University/Lital/weekly presentation/14.8.23/npfr_up_sc.tiff")
 tiff(file=plotname,units="in",height=11,width=11,res=600)

pheatmap(mat, scale = "row", cluster_cols = T,cluster_rows  = T,show_rownames = T,fontsize_row = 8, fontsize_col = 8,color=colorRampPalette(c("navy", "white", "red"))(50))

dev.off()
```

